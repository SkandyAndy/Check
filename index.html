<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="manifest" href="manifest.json">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Check">
    
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
</head>
<body>

<header>
        <h1>Check</h1>
        <div class="header-buttons">
            <button id="refresh-btn" title="Ansicht neu laden & sortieren">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-54-87-87t-121-33q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z"/></svg>
            </button>
            <button id="view-toggle-btn" title="Ansicht wechseln">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24"><path d="M440 856V616H200v240h240Zm320 0V616H520v240h240ZM200 536V296h240v240H200Zm320 0V296h240v240H520Z"/></svg>
            </button>
            <button id="settings-btn" title="Einstellungen">
                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 6.5 6.5" width="20"><path style="fill:currentColor;fill-rule:evenodd;stroke:none;stroke-width:0.209975"
                    d="m 3.1588064,5.2744536 0.1036053,-0.00152 C 3.4961593,5.2635248 3.726633,5.2146718 3.9440694,5.1283784 L 4.5390913,6.044637 5.2435623,5.587173 4.6485916,4.6710658 4.7061096,4.6128317 C 4.8716094,4.437297 5.0053317,4.2343306 5.1013556,4.0130126 L 6.1693911,4.240053 6.3440479,3.4185244 5.2759612,3.1915354 5.2744286,3.088037 C 5.2650927,2.8542409 5.2162821,2.623721 5.1300174,2.4062345 L 6.0461523,1.8112798 5.5886719,1.1068344 4.672378,1.7018863 4.6142959,1.64437 C 4.4387453,1.4788828 4.2358069,1.3451139 4.0145062,1.2490359 L 4.2415035,0.18103852 3.4199456,0.00638812 3.1929485,1.0744367 3.0894462,1.0759737 c -0.2337834,0.00937 -0.464289,0.05826 -0.6817608,0.1445596 L 1.8126635,0.30427206 1.1082952,0.76173623 1.7032657,1.6779462 1.6456964,1.7361799 C 1.4802256,1.9116891 1.3465031,2.1146104 1.2505014,2.3358967 L 0.1823636,2.1088566 0.00770675,2.9303848 1.0758961,3.1574252 l 0.00153,0.1035499 c 0.00935,0.2337429 0.058173,0.4642243 0.1444111,0.6816851 L 0.30569733,4.5376094 0.76307513,5.242055 1.6793692,4.6470032 l 0.058184,0.057567 c 0.175515,0.1654683 0.3784308,0.2991986 0.599685,0.3952832 L 2.1102414,6.1678507 2.9317992,6.3425012 Z M 3.1164623,4.327794 3.0578162,4.3233339 C 2.4459699,4.2605379 1.9907225,3.7292499 2.0224873,3.1150323 2.0551919,2.4779835 2.5982338,1.988173 3.2352926,2.0210962 3.8723574,2.0538144 4.362176,2.5968222 4.3292676,3.233858 4.2977177,3.8478324 3.7906808,4.3293766 3.1758774,4.3292806 Z"
                    id="path1" />
                </svg>
            </button>
            <button id="add-subject-btn" title="Neue Liste hinzufügen">+</button>
        </div>
    </header>

<main id="view-container">
        
        <div id="backup-reminder" class="reminder-banner" style="display: none;">
            <span>Dein letztes Backup ist eine Weile her.</span>
            <div>
                <button id="backup-reminder-btn">Jetzt sichern</button>
                <button id="backup-reminder-close-btn" title="Ausblenden">X</button>
            </div>
        </div>

        <div id="list-view" class="view active">
            </div>

        <div id="column-view" class="view">
            </div>

        <div id="settings-view" class="view">
            <div class="settings-header">
                <button id="settings-back-btn" title="Zurück">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24"><path d="M400 976 0 576l400-400 56 57-343 343 343 343-56 57Z"/></svg>
                </button>
                <h2>Einstellungen</h2>
            </div>

            <div class="settings-section">
                <h3>Daten-Backup</h3>
                <p>Sichere alle Listen und Aufgaben als <code>check_backup.json</code> Datei. Bewahre diese Datei sicher auf (z.B. in deiner Cloud), um sie später wiederherzustellen.</p>
                <button id="export-data-btn" class="settings-action-btn">Alle Daten exportieren</button>
            </div>

            <div class="settings-section">
                <h3>Daten-Wiederherstellung</h3>
                <p>Importiere eine zuvor exportierte Backup-Datei. Bestehende Daten werden nicht gelöscht. Die App fügt nur Listen und Aufgaben hinzu, die noch nicht vorhanden sind.</p>
                <button id="import-data-btn" class="settings-action-btn import">Backup importieren</button>
                <input type="file" id="import-file-input" class="visually-hidden" accept=".json">
            </div>

            <div class="settings-section">
                <h3>Version &amp; Patchnotes</h3>
                <p>Du nutzt aktuell Version: <strong id="app-version-display">?.?</strong></p>
                
                <ul class="patch-notes-list">
                    <li>
                        <strong>Version 1.5</strong> (Aktuell)
                        <ul>
                            <li>Neue Aufgaben-Details:
                                <ul>
                                    <li>Aufgaben können jetzt optional eine Fälligkeits-Uhrzeit haben.</li>
                                    <li>Ein separates Notiz-/Beschreibungsfeld wurde hinzugefügt.</li>
                                    <li>Checklisten (Unteraufgaben) können nun zu Aufgaben hinzugefügt werden.</li>
                                </ul>
                            </li>
                            <li>Überarbeitete Aufgaben-Anzeige:
                                <ul>
                                    <li>Aufgabenkarten sind nun aufklappbar ("Mehr..."), um Notizen und Checklisten anzuzeigen und die Übersicht zu verbessern.</li>
                                    <li>Ein visueller Indikator ("...") zeigt an, wenn Details vorhanden sind.</li>
                                    <li>Der Fortschritt der Checkliste ("x/y") wird direkt auf der Karte angezeigt.</li>
                                    <li>Fälligkeitsdatum und -zeit sind immer im Kartenkopf sichtbar.</li>
                                    <li>Ein eigener "Bearbeiten"-Knopf (Stift-Symbol) wurde auf den Aufgabenkarten hinzugefügt.</li>
                                </ul>
                            </li>
                            <li>Verbesserungen & Fixes:
                                <ul>
                                    <li>Die Haupt-Checkbox auf Aufgabenkarten ist nun korrekt vertikal zentriert.</li>
                                    <li>Das Abhaken einer Hauptaufgabe sortiert die Liste nicht mehr sofort neu, um Sprünge zu vermeiden (Sortierung erfolgt bei anderen Aktionen oder manuellem Refresh).</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <strong>Version 1.4</strong>
                        <ul>
                            <li>Einstellungen-Seite für Import/Export hinzugefügt.</li>
                            <li>Backup-Erinnerung hinzugefügt (wenn 7+ Tage kein Export).</li>
                            <li>Patchnotes & Versionsanzeige in den Einstellungen hinzugefügt.</li>
                            <li>Mitbewohner happy gemacht mit Patchnotes.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Version 1.3</strong>
                        <ul>
                            <li>Listen-Sortierung: Offene Listen (1.), erledigte Listen (2.), leere Listen (3.).</li>
                            <li>"Wichtig"-Markierung für Aufgaben hinzugefügt.</li>
                            <li>Aufgaben-Sortierung: Wichtige Aufgaben werden nun priorisiert.</li>
                        </ul>
                    </li>
                     <li>
                        <strong>Version 1.2</strong>
                        <ul>
                            <li>Löschen von Listen (inkl. Bestätigung) hinzugefügt.</li>
                            <li>"Alle offenen Aufgaben"-Übersicht hinzugefügt.</li>
                            <li>Sortierung von Aufgaben (Erledigte nach unten, dann nach Datum).</li>
                        </ul>
                    </li>
                    <li>
                        <strong>Version 1.0 - 1.1</strong>
                        <ul>
                            <li>Basis-Setup (PWA, IndexedDB), Listen- & Spaltenansicht.</li>
                            <li>Erstellen, Bearbeiten, Löschen von Aufgaben.</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <div id="modal-backdrop"></div>

    <div id="add-subject-modal" class="modal">
        <h2>Neue Liste</h2>
        <input type="text" id="subject-name-input" placeholder="Listenname">
        <div class="modal-actions">
            <button id="cancel-add-subject">Abbrechen</button>
            <button id="save-add-subject">Speichern</button>
        </div>
    </div>

<div id="add-task-modal" class="modal">
        <h2>Neue Aufgabe</h2>
        <input type="hidden" id="task-subject-id-input">
        
        <label for="add-task-title-input">Titel</label>
        <input type="text" id="add-task-title-input" placeholder="Aufgabenname">
        
        <label for="add-task-notes-input">Notizen</label>
        <textarea id="add-task-notes-input" placeholder="(Optional)"></textarea>
        
        <div class="task-modal-options">
            <div class="date-option">
                <label for="add-task-due-date-input">Fällig bis:</label>
                <input type="date" id="add-task-due-date-input">
            </div>
            <div class="time-option">
                <label for="add-task-due-time-input">Uhrzeit:</label>
                <input type="time" id="add-task-due-time-input">
            </div>
            <button type="button" id="add-task-priority-toggle" class="priority-toggle-btn" title="Als wichtig markieren">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24"><path d="M480 976q-33 0-56.5-23.5T400 896q0-33 23.5-56.5T480 816q33 0 56.5 23.5T560 896q0 33-23.5 56.5T480 976Zm-40-200v-480h80v480h-80Z"/></svg>
            </button>
        </div>

        <div class="checklist-editor">
            <label>Checkliste (Optional)</label>
            <div class="checklist-input-group">
                <input type="text" id="add-checklist-item-input" placeholder="Neuer Checklisten-Punkt">
                <button type="button" id="add-checklist-item-btn" title="Hinzufügen">+</button>
            </div>
            <ul class="checklist-items-list" id="add-checklist-items-list">
                </ul>
        </div>

        <div class="modal-actions">
            <button id="cancel-add-task">Abbrechen</button>
            <button id="save-add-task">Speichern</button>
        </div>
    </div>

    <div id="edit-task-modal" class="modal">
        <h2>Aufgabe bearbeiten</h2>
        <input type="hidden" id="edit-task-id-input">
            
        <label for="edit-task-title-input">Titel</label>
        <input type="text" id="edit-task-title-input" placeholder="Titel der Aufgabe">

        <label for="edit-task-notes-input">Notizen</label>
        <textarea id="edit-task-notes-input" placeholder="Details, Links oder Beschreibungen..."></textarea>

        <div class="task-modal-options">
            <div class="date-option">
                <label for="edit-task-due-date-input">Fällig bis:</label>
                <input type="date" id="edit-task-due-date-input">
            </div>
            <div class="time-option">
                <label for="edit-task-due-time-input">Uhrzeit:</label>
                <input type="time" id="edit-task-due-time-input">
            </div>
            <button type="button" id="edit-task-priority-toggle" class="priority-toggle-btn" title="Als wichtig markieren">
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24"><path d="M480 976q-33 0-56.5-23.5T400 896q0-33 23.5-56.5T480 816q33 0 56.5 23.5T560 896q0 33-23.5 56.5T480 976Zm-40-200v-480h80v480h-80Z"/></svg>
            </button>
        </div>
            
        <div class="checklist-editor">
            <label>Checkliste</label>
            <div class="checklist-input-group">
                <input type="text" id="edit-checklist-item-input" placeholder="Neuer Checklisten-Punkt">
                <button type="button" id="edit-checklist-item-btn" title="Hinzufügen">+</button>
            </div>
            <ul class="checklist-items-list" id="edit-checklist-items-list">
                </ul>
        </div>

        <div class="modal-actions">
            <button id="cancel-edit-task">Abbrechen</button>
            <button id="save-edit-task">Speichern</button>
        </div>
    </div>

    <div id="delete-subject-modal" class="modal">
        <h2>Liste löschen</h2>
        <input type="hidden" id="delete-subject-id-input">
        <p>Möchtest du die Liste "<strong id="delete-subject-name"></strong>" wirklich löschen?</p>
        <p class="warning">Alle zugehörigen Aufgaben werden ebenfalls endgültig gelöscht!</p>
        
        <div class="modal-actions">
            <button id="cancel-delete-subject">Abbrechen</button>
            <button id="confirm-delete-subject">Endgültig löschen</button>
        </div>
    </div>

    <script src="app.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('ServiceWorker registriert:', registration))
                    .catch(err => console.log('ServiceWorker Registrierung fehlgeschlagen:', err));
            });
        }
    </script>

</body>
</html>